import{d as P,r as x,c as S,w as B,Y as U,C as k,D as d,N as E,ap as A,I as c,z as n,ah as J,O as i,R as O,P as j,u as h,S as H,ad as K,L as Y,M as q,K as N,J as T,ae as f,af as G,aa as Q}from"./element-plus-qgwGTzxg.js";import{F as g}from"./index-CXlIl4tL.js";import{u as W,C as I,d as X}from"./mainAppView-035_X34S.js";import{i as b,h as _}from"./utils-DWTWu0JZ.js";import"./fontAwesomeLibrary--AcGPZoj.js";const Z={class:"differences-panel"},ee={key:1},te={class:"commit-box"},se={class:"operation-box"},ae={class:"diff-box"},oe={class:"file-info"},ne={class:"file-name"},le={class:"file-path"},ce={class:"others"},ie=P({__name:"DifferencesPanel",emits:["change:loading","change:tipLoad"],setup(re,{emit:V}){const $=W(),w=V,u=x(!1),z=S(()=>!b.ready);B(()=>u.value,t=>{w("change:loading",t)},{immediate:!0}),B(()=>z.value,t=>{w("change:tipLoad",t)},{immediate:!0});const C=x(!1),v=x(""),p=S(()=>$.settings.repoName),r=x([]);U(()=>{b.ready&&y()});const F=async t=>{const e=await _.get(t,p.value),a=`blob ${new TextEncoder().encode(e).length}\0`+e;return I.SHA1(I.enc.Utf8.parse(a)).toString()},y=async()=>{u.value=!0;const t=[],e=await b.getRepoTree(),s={};e.tree.forEach(a=>{a.path&&a.sha&&(s[a.path]=a.sha)});const o=await _.list(p.value);for(const a of o)s[a]?await F(a)!==s[a]&&t.push([a,"update"]):t.push([a,"create"]);r.value=t,u.value=!1,M()},L=()=>{C.value=!0,y().then(()=>{f({type:"success",message:"刷新完成"}),setTimeout(()=>{C.value=!1},1e3)})},M=()=>{let t=`feat: Update blog articles

`;const e={create:[],delete:[],change:[]};r.value.forEach(([s,o])=>{o==="create"?e.create.push(s):o==="update"&&e.change.push(s)}),e.create.length>0&&(t+=`- Add new articles:
`,e.create.forEach(s=>{t+=`  - ${s}
`})),e.delete.length>0&&(t+=`- Delete outdated articles:
`,e.delete.forEach(s=>{t+=`  - ${s}
`})),e.change.length>0&&(t+=`- Update articles:
`,e.change.forEach(s=>{t+=`  - ${s}
`})),v.value=t},D=(t=null)=>{const e=[];let s=[];for(const o in r.value)e.push(r.value[o][0]);if(!t)s=e;else if(e.indexOf(t)===-1){f({type:"error",message:"File not found"});return}else s=[t];G.confirm("此操作将删除本地更改且无法恢复，是否继续？","警告-危险操作",{confirmButtonText:"确定",cancelButtonText:"取消，保留更改",type:"warning"}).then(()=>{s.forEach(o=>{_.delete(o,p.value)}),y(),f({type:"success",message:"Delete completed"})}).catch(o=>{console.error(o),f({type:"info",message:"Delete canceled"})})},R=async()=>{const t=v.value;if(!t){f({type:"error",message:"Please input commit message"});return}u.value=!0;const e=[];for(const s of r.value){const o=s[0],a=await _.get(o,p.value);e.push({path:o,content:a})}b.commitChanges(e,t).then(async()=>{f({type:"success",message:"Commit success"});for(const s of e)await _.delete(s.path,p.value);y(),u.value=!1}).catch(s=>{console.error(s),Q({title:"Error",message:"提交失败，发生错误！",type:"error"}),u.value=!1})};return(t,e)=>{const s=A,o=J,a=j,m=K;return d(),k("div",Z,[z.value?(d(),E(s,{key:0,description:"离线模式无法提交文件"})):(d(),k("div",ee,[c("div",te,[n(o,{modelValue:v.value,"onUpdate:modelValue":e[0]||(e[0]=l=>v.value=l),autosize:{minRows:2,maxRows:4},type:"textarea",placeholder:"commit message",clearable:""},null,8,["modelValue"]),n(a,{type:"primary",disabled:r.value.length<=0,onClick:R},{default:i(()=>e[2]||(e[2]=[O("提交")])),_:1},8,["disabled"])]),c("div",se,[e[3]||(e[3]=c("div",{class:"title"},"更改列表",-1)),c("div",null,[n(m,{class:"box-item",effect:"dark",content:"刷新数据",placement:"bottom"},{default:i(()=>[n(a,{link:"",size:"small",onClick:L},{default:i(()=>[n(h(g),{style:{"margin-right":"15px"},icon:["fas","arrows-rotate"],size:"lg",class:H({"rotate-animation":C.value})},null,8,["class"])]),_:1})]),_:1}),n(m,{class:"box-item",effect:"dark",content:"放弃所有更改",placement:"bottom"},{default:i(()=>[n(a,{link:"",size:"small",onClick:e[1]||(e[1]=l=>D())},{default:i(()=>[n(h(g),{class:"undo_all",icon:["fas","rotate-left"],size:"lg"})]),_:1})]),_:1})])]),c("div",ae,[(d(!0),k(Y,null,q(r.value,l=>(d(),k("div",{class:"diff-item",key:l[0]},[c("div",oe,[c("span",ne,N(l[0].split("/").pop()),1),n(m,{class:"box-item",effect:"dark",content:l[0],placement:"right"},{default:i(()=>[c("span",le,N(l[0].split("/").slice(0,-1).join("/")),1)]),_:2},1032,["content"])]),c("div",ce,[n(m,{class:"box-item",effect:"dark",content:"放弃更改",placement:"bottom"},{default:i(()=>[n(a,{link:"",size:"small",onClick:de=>D(l[0])},{default:i(()=>[n(h(g),{class:"undo",icon:["fas","rotate-left"],size:"lg"})]),_:2},1032,["onClick"])]),_:2},1024),l[1]==="update"?(d(),E(h(g),{key:0,icon:["fas","u"],size:"xs",style:{color:"var(--el-color-primary)"}})):T("",!0),l[1]==="create"?(d(),E(h(g),{key:1,icon:["fas","n"],size:"xs",style:{color:"var(--el-color-success)"}})):T("",!0)])]))),128))])]))])}}}),ge=X(ie,[["__scopeId","data-v-942c339b"]]);export{ge as default};
