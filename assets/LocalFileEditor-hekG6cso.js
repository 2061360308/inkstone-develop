const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/MdEditor-BItgetc9.js","assets/element-plus-qgwGTzxg.js","assets/element-plus-DJ7jyVtF.css","assets/index-C7UPnry-.js","assets/utils-DWTWu0JZ.js","assets/mainAppView-035_X34S.js","assets/mainAppView-CTriU59l.css","assets/MdEditor-9ZFswB37.css","assets/CodemirrorEditor-BOtTYmAB.js","assets/CodemirrorEditor-DsP6y13a.css"])))=>i.map(i=>d[i]);
import{a as V,u as I,s as T,_ as y,d as A}from"./mainAppView-035_X34S.js";import{d as D,r as i,Y as L,w as M,C as P,D as v,H as N,J as E,N as h,Q as b,u as O,U,B as g,ae as q}from"./element-plus-qgwGTzxg.js";import{h as s,i as H}from"./utils-DWTWu0JZ.js";const J={class:"local-file-editor file-editor"},Q=D({__name:"LocalFileEditor",props:{id:{type:String,required:!0}},setup(m){const f=V(),x=I(),{tabs:C}=T(f),u=i(!1),k=m,_=i(null),d=i(""),w=i(!0),c=i(!0);let r="",a="";const l=i(null);let p;L(async()=>{const t=C.value.find(o=>o.id===k.id),e=t==null?void 0:t.data.file;a=e.path,r=e.repo;const n=a.split(".").pop();w.value=n==="md"||n==="markdown",w.value?p=g(()=>y(()=>import("./MdEditor-BItgetc9.js"),__vite__mapDeps([0,1,2,3,4,5,6,7]))):p=g(()=>y(()=>import("./CodemirrorEditor-BOtTYmAB.js").then(o=>o.M),__vite__mapDeps([8,5,1,2,4,6,9]))),_.value=e,d.value=a.split("/").pop()}),M(()=>c.value,t=>{const e=a.split("/").pop()||"";t?f.titleBarText=e:f.titleBarText=e+" *"});const S=async()=>{var t;if(await s.isExist(a,r)){const e=await s.get(a,r);(t=l.value)==null||t.setContent(e,!0),u.value=!0}else{const e=x.settings.repoBranch.value;H.getFileContent(a,e).then(n=>{var o;s.write(a,n.decodedContent,r),(o=l.value)==null||o.setContent(n.decodedContent,!0),u.value=!0})}},B=async()=>{if(!l.value)return;const t=l.value.getContent();await s.write(a,t,r),q({message:"文章保存成功",grouping:!0,type:"success"}),c.value=!0},F=async t=>{var n;const e=a.replace(d.value,t);try{await s.write(e,((n=l.value)==null?void 0:n.getContent())||"",r);try{return await s.delete(a,r),a=e,d.value=t,c.value=!0,!0}catch(o){console.error("delete failed",o);try{return await s.delete(e,r),!1}catch(R){return console.error("delete new failed",R),!1}}}catch(o){return console.error("write failed",o),!1}};return(t,e)=>{const n=U;return v(),P("div",J,[_.value?N((v(),h(O(p),{key:0,editor:m.id,class:"editor","file-name":d.value,modelValue:c.value,"onUpdate:modelValue":e[0]||(e[0]=o=>c.value=o),editorReady:S,"save-file":B,"rename-file":F,ref_key:"EditorInstanceRef",ref:l},null,8,["editor","file-name","modelValue"])),[[b,u.value]]):E("",!0),u.value?E("",!0):(v(),h(n,{key:1,rows:7,animated:"",style:{margin:"auto","max-width":"800px",padding:"40px"}}))])}}}),z=A(Q,[["__scopeId","data-v-0d7e4259"]]);export{z as default};
