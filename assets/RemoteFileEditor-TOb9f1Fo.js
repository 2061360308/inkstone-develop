import{d as H,r as l,w as K,N as g,D as i,O as a,C as w,L as O,M as Q,av as Y,z as t,aw as j,I as s,K as M,J as z,a7 as G,P,R as X,ax as Z,c as ee,Y as te,H as T,u as k,ad as oe,Q as D,F as ae,U as se,a9 as ne}from"./element-plus-qgwGTzxg.js";import{C as le}from"./CodemirrorEditor-BOtTYmAB.js";import{F as V}from"./index-CXlIl4tL.js";import{i as U}from"./utils-DWTWu0JZ.js";import{V as ie}from"./index-C7UPnry-.js";import{d as W,a as re,u as de,s as ce}from"./mainAppView-035_X34S.js";import"./fontAwesomeLibrary--AcGPZoj.js";const ue={class:"commit"},me={class:"info"},pe={class:"commiter"},ve={class:"operation"},_e=H({__name:"CommitHistory",props:{path:{type:String,required:!0}},emits:["change-sha"],setup(C,{emit:F}){const x=C,$=F,u=f=>{$("change-sha",f)},v=l([]);return K(()=>x.path,async f=>{v.value=await U.getFileCommitHistory(f)},{immediate:!0}),(f,n)=>{const b=G,S=P,_=j,r=Y,d=Z;return i(),g(d,null,{default:a(()=>[(i(!0),w(O,null,Q(v.value,o=>(i(),g(r,{timestamp:o.commit.author.date,placement:"top",key:o.sha},{default:a(()=>[t(_,null,{default:a(()=>[s("div",ue,[s("div",me,[s("p",null,M(o.commit.message),1),s("div",pe,[o.author?(i(),g(b,{key:0,class:"avatar",src:o.author.avatar_url+"&size=32"},null,8,["src"])):z("",!0),s("span",null,M(o.commit.author.name),1),n[0]||(n[0]=s("span",null," committed on ",-1)),s("span",null,M(o.commit.author.date),1)])]),s("div",ve,[t(S,{link:"",size:"small",onClick:h=>u(o.sha)},{default:a(()=>n[1]||(n[1]=[X("查看")])),_:2},1032,["onClick"])])])]),_:2},1024)]),_:2},1032,["timestamp"]))),128))]),_:1})}}}),fe=W(_e,[["__scopeId","data-v-a60d11f5"]]),he={class:"remote-file-editor file-editor"},ye={class:"operation-bar"},ke={key:0,class:"preview"},we={key:0},ge={key:1},Ce={class:"history"},xe={class:"currentState"},be={class:"markdown-preview"},Se=H({__name:"RemoteFileEditor",props:{id:{type:String,required:!0}},setup(C){const F=re(),x=de(),{tabs:$}=ce(F),u=ee(()=>x.settings.repoBranch),v=l(!1),f=C,n=l(null),b=l(""),S=l(!0);let _="",r;const d=l(u.value),o=l(null),h=l(!1),E=l(!1),q=x.settings.editorMaxWidth,R=l(null),B=l(null);te(async()=>{r=$.value.find(c=>c.id===f.id);const m=r==null?void 0:r.data.file;_=m.path;const e=_.split(".").pop();o.value=e==="md"||e==="markdown"?"md":e,d.value=u.value,n.value=m,b.value=_.split("/").pop(),console.log("onMounted")});const N=m=>{var e;(e=R.value)==null||e.setContent(m,!0),ie.preview(B.value,m,{speech:{enable:!0},anchor:1,mode:"dark"})},I=(m=null)=>{var e,c;if(d.value=m||u.value,console.log((e=n.value)==null?void 0:e.content),d.value===u.value&&((c=n.value)!=null&&c.content)){N(n.value.content),v.value=!0;return}console.log("sha",d.value),E.value=!1,U.getFileContent(_,d.value).then(p=>{(r==null?void 0:r.data.file).content=p.decodedContent,N(p.decodedContent),d.value===u.value&&n.value&&(n.value.content=p.decodedContent),v.value=!0})},A=async()=>{console.log("editor ready"),I()};return(m,e)=>{const c=P,p=oe,L=se,J=ne;return i(),w("div",he,[s("div",ye,[o.value==="md"?(i(),w("div",ke,[h.value?(i(),w("div",we,[t(p,{class:"box-item",effect:"dark",content:"预览Markdown",placement:"bottom"},{default:a(()=>[t(c,{type:"primary",size:"small",disabled:o.value!=="md",onClick:e[0]||(e[0]=y=>h.value=!1)},{default:a(()=>[t(k(V),{icon:["fas","code"]})]),_:1},8,["disabled"])]),_:1})])):(i(),w("div",ge,[t(p,{class:"box-item",effect:"dark",content:"预览Markdown",placement:"bottom"},{default:a(()=>[t(c,{type:"primary",size:"small",disabled:o.value!=="md",onClick:e[1]||(e[1]=y=>h.value=!0)},{default:a(()=>[t(k(V),{icon:["fas","magnifying-glass"]})]),_:1},8,["disabled"])]),_:1})]))])):z("",!0),s("div",Ce,[t(p,{class:"box-item",effect:"dark",content:"查看文件提交历史",placement:"bottom"},{default:a(()=>[t(c,{type:"primary",size:"small",onClick:e[2]||(e[2]=y=>E.value=!0)},{default:a(()=>[t(k(V),{icon:["fas","code-commit"]})]),_:1})]),_:1})]),s("div",xe,[t(p,{class:"box-item",effect:"dark",content:"当前版本",placement:"bottom"},{default:a(()=>[t(c,{type:"primary",size:"small",disabled:u.value===d.value,onClick:e[3]||(e[3]=()=>I())},{default:a(()=>[t(k(V),{icon:["fas","house-circle-check"]})]),_:1},8,["disabled"])]),_:1})])]),T(s("div",be,[s("div",{class:"markdown-preview-inner",style:ae({maxWidth:k(q).toString()+"px"}),ref_key:"markdownPreview",ref:B},null,4)],512),[[D,h.value]]),n.value?T((i(),g(le,{key:0,class:"editor",ref_key:"EditorInstanceRef",ref:R,editor:C.id,"file-name":b.value,modelValue:S.value,"onUpdate:modelValue":e[4]||(e[4]=y=>S.value=y),editorReady:A,"read-only":!0},null,8,["editor","file-name","modelValue"])),[[D,!h.value&&v.value]]):z("",!0),v.value?z("",!0):(i(),g(L,{key:1,rows:7,animated:"",style:{margin:"auto","max-width":"800px",padding:"40px"}})),t(J,{"modal-class":"history-drawer",modelValue:E.value,"onUpdate:modelValue":e[5]||(e[5]=y=>E.value=y),title:"提交历史",direction:"rtl",size:"100%"},{default:a(()=>[t(fe,{path:k(_),onChangeSha:I},null,8,["path"])]),_:1},8,["modelValue"])])}}}),Re=W(Se,[["__scopeId","data-v-bef766a6"]]);export{Re as default};
