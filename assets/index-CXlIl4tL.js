import{d as K,Y as Q,a1 as me,N as R,G as ve,D as b,C as j,z as m,a7 as oe,c as L,w as le,h as ge,r as I,H as ye,V as he,I as w,O as h,ad as be,u as P,aj as _e,P as we,ae as C,ah as xe,ak as Oe,R as T,al as Se,S as X,L as ee,M as te,am as ke,n as Be,an as Ie}from"./element-plus-qgwGTzxg.js";import{a as Pe,b as se,c as ie,d as ue,u as je,e as Le,f as ze,M as Ne,g as Ae,L as Ve}from"./mainAppView-035_X34S.js";import{o as Ce,b as Te,v as Re,e as ne,i as W,a as Ee,d as $e}from"./utils-DWTWu0JZ.js";import{p as G,i as De,a as Fe}from"./fontAwesomeLibrary--AcGPZoj.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&a(c)}).observe(document,{childList:!0,subtree:!0});function n(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function a(r){if(r.ep)return;r.ep=!0;const s=n(r);fetch(r.href,s)}})();const Me=K({__name:"App",setup(e){return Q(()=>{const t=n=>{n.preventDefault()};window.addEventListener("contextmenu",t),me(()=>{window.removeEventListener("contextmenu",t)})}),(t,n)=>{const a=ve("router-view");return b(),R(a)}}}),Ue={class:"launch-main"},qe=K({__name:"LaunchView",setup(e){const t=se(),n=ie(),a=Pe();return Q(()=>{const{query:r}=t;a.routerParams=r,n.replace({query:{}}),"launchQueue"in window?window.launchQueue.setConsumer(s=>{if(s.files.length)for(const c of s.files)Ce(c)}):console.error("File Handling API is not supported!"),Te(),n.push({name:"main",query:{from:"launch"}})}),(r,s)=>{const c=oe;return b(),j("div",Ue,[m(c,{src:"/cover.png",class:"cover-img"})])}}}),Ke=ue(qe,[["__scopeId","data-v-f22d0622"]]);function ae(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,a)}return n}function B(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?ae(Object(n),!0).forEach(function(a){v(e,a,n[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ae(Object(n)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(n,a))})}return e}function We(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var a=n.call(e,t);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function He(e){var t=We(e,"string");return typeof t=="symbol"?t:t+""}function q(e){"@babel/helpers - typeof";return q=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},q(e)}function v(e,t,n){return t=He(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ge(e,t){if(e==null)return{};var n={};for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){if(t.indexOf(a)>=0)continue;n[a]=e[a]}return n}function Qe(e,t){if(e==null)return{};var n=Ge(e,t),a,r;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)a=s[r],!(t.indexOf(a)>=0)&&Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var Ye=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},ce={exports:{}};(function(e){(function(t){var n=function(o,i,g){if(!x(i)||N(i)||$(i)||S(i)||f(i))return i;var u,l=0,y=0;if(_(i))for(u=[],y=i.length;l<y;l++)u.push(n(o,i[l],g));else{u={};for(var O in i)Object.prototype.hasOwnProperty.call(i,O)&&(u[o(O,g)]=n(o,i[O],g))}return u},a=function(o,i){i=i||{};var g=i.separator||"_",u=i.split||/(?=[A-Z])/;return o.split(u).join(g)},r=function(o){return A(o)?o:(o=o.replace(/[\-_\s]+(.)?/g,function(i,g){return g?g.toUpperCase():""}),o.substr(0,1).toLowerCase()+o.substr(1))},s=function(o){var i=r(o);return i.substr(0,1).toUpperCase()+i.substr(1)},c=function(o,i){return a(o,i).toLowerCase()},d=Object.prototype.toString,f=function(o){return typeof o=="function"},x=function(o){return o===Object(o)},_=function(o){return d.call(o)=="[object Array]"},N=function(o){return d.call(o)=="[object Date]"},$=function(o){return d.call(o)=="[object RegExp]"},S=function(o){return d.call(o)=="[object Boolean]"},A=function(o){return o=o-0,o===o},V=function(o,i){var g=i&&"process"in i?i.process:i;return typeof g!="function"?o:function(u,l){return g(u,o,l)}},D={camelize:r,decamelize:c,pascalize:s,depascalize:c,camelizeKeys:function(o,i){return n(V(r,i),o)},decamelizeKeys:function(o,i){return n(V(c,i),o,i)},pascalizeKeys:function(o,i){return n(V(s,i),o)},depascalizeKeys:function(){return this.decamelizeKeys.apply(this,arguments)}};e.exports?e.exports=D:t.humps=D})(Ye)})(ce);var Ze=ce.exports,Je=["class","style"];function Xe(e){return e.split(";").map(function(t){return t.trim()}).filter(function(t){return t}).reduce(function(t,n){var a=n.indexOf(":"),r=Ze.camelize(n.slice(0,a)),s=n.slice(a+1).trim();return t[r]=s,t},{})}function et(e){return e.split(/\s+/).reduce(function(t,n){return t[n]=!0,t},{})}function fe(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(typeof e=="string")return e;var a=(e.children||[]).map(function(f){return fe(f)}),r=Object.keys(e.attributes||{}).reduce(function(f,x){var _=e.attributes[x];switch(x){case"class":f.class=et(_);break;case"style":f.style=Xe(_);break;default:f.attrs[x]=_}return f},{attrs:{},class:{},style:{}});n.class;var s=n.style,c=s===void 0?{}:s,d=Qe(n,Je);return ge(e.tag,B(B(B({},t),{},{class:r.class,style:B(B({},r.style),c)},r.attrs),d),a)}var pe=!1;try{pe=!0}catch{}function tt(){if(!pe&&console&&typeof console.error=="function"){var e;(e=console).error.apply(e,arguments)}}function H(e,t){return Array.isArray(t)&&t.length>0||!Array.isArray(t)&&t?v({},e,t):{}}function nt(e){var t,n=(t={"fa-spin":e.spin,"fa-pulse":e.pulse,"fa-fw":e.fixedWidth,"fa-border":e.border,"fa-li":e.listItem,"fa-inverse":e.inverse,"fa-flip":e.flip===!0,"fa-flip-horizontal":e.flip==="horizontal"||e.flip==="both","fa-flip-vertical":e.flip==="vertical"||e.flip==="both"},v(v(v(v(v(v(v(v(v(v(t,"fa-".concat(e.size),e.size!==null),"fa-rotate-".concat(e.rotation),e.rotation!==null),"fa-pull-".concat(e.pull),e.pull!==null),"fa-swap-opacity",e.swapOpacity),"fa-bounce",e.bounce),"fa-shake",e.shake),"fa-beat",e.beat),"fa-fade",e.fade),"fa-beat-fade",e.beatFade),"fa-flash",e.flash),v(v(t,"fa-spin-pulse",e.spinPulse),"fa-spin-reverse",e.spinReverse));return Object.keys(n).map(function(a){return n[a]?a:null}).filter(function(a){return a})}function re(e){if(e&&q(e)==="object"&&e.prefix&&e.iconName&&e.icon)return e;if(G.icon)return G.icon(e);if(e===null)return null;if(q(e)==="object"&&e.prefix&&e.iconName)return e;if(Array.isArray(e)&&e.length===2)return{prefix:e[0],iconName:e[1]};if(typeof e=="string")return{prefix:"fas",iconName:e}}var M=K({name:"FontAwesomeIcon",props:{border:{type:Boolean,default:!1},fixedWidth:{type:Boolean,default:!1},flip:{type:[Boolean,String],default:!1,validator:function(t){return[!0,!1,"horizontal","vertical","both"].indexOf(t)>-1}},icon:{type:[Object,Array,String],required:!0},mask:{type:[Object,Array,String],default:null},maskId:{type:String,default:null},listItem:{type:Boolean,default:!1},pull:{type:String,default:null,validator:function(t){return["right","left"].indexOf(t)>-1}},pulse:{type:Boolean,default:!1},rotation:{type:[String,Number],default:null,validator:function(t){return[90,180,270].indexOf(Number.parseInt(t,10))>-1}},swapOpacity:{type:Boolean,default:!1},size:{type:String,default:null,validator:function(t){return["2xs","xs","sm","lg","xl","2xl","1x","2x","3x","4x","5x","6x","7x","8x","9x","10x"].indexOf(t)>-1}},spin:{type:Boolean,default:!1},transform:{type:[String,Object],default:null},symbol:{type:[Boolean,String],default:!1},title:{type:String,default:null},titleId:{type:String,default:null},inverse:{type:Boolean,default:!1},bounce:{type:Boolean,default:!1},shake:{type:Boolean,default:!1},beat:{type:Boolean,default:!1},fade:{type:Boolean,default:!1},beatFade:{type:Boolean,default:!1},flash:{type:Boolean,default:!1},spinPulse:{type:Boolean,default:!1},spinReverse:{type:Boolean,default:!1}},setup:function(t,n){var a=n.attrs,r=L(function(){return re(t.icon)}),s=L(function(){return H("classes",nt(t))}),c=L(function(){return H("transform",typeof t.transform=="string"?G.transform(t.transform):t.transform)}),d=L(function(){return H("mask",re(t.mask))}),f=L(function(){return De(r.value,B(B(B(B({},s.value),c.value),d.value),{},{symbol:t.symbol,title:t.title,titleId:t.titleId,maskId:t.maskId}))});le(f,function(_){if(!_)return tt("Could not find one or more icon(s)",r.value,d.value)},{immediate:!0});var x=L(function(){return f.value?fe(f.value.abstract[0],{},a):null});return function(){return x.value}}});const at={class:"container"},rt={class:"card"},ot={class:"left"},lt={key:0,class:"right"},st={class:"title-box"},it={class:"options"},ut={class:"remember-me"},ct={class:"login-methods"},ft={key:1,class:"right"},pt=K({__name:"LoginView",setup(e){const t=je(),n=se(),a=ie(),r=I(!1),s=I("github"),c=I(!1),d=I(!1),f=I(""),x=I([]),_=I([]),N=L(()=>t.settings.repoName),$=async u=>{W.repo=u,_.value=[];const l=await W.getRepoBranches();l&&l.forEach(y=>{_.value.push({label:y.name,value:y.name})})};le(N,async u=>{u&&await $(u||"")});let S;const A=async u=>{const{tokenValid:l,repoValid:y,hasPushAccess:O,branchValid:k,installedApp:z}=await Re(u,t.settings.repoName,t.settings.repoBranch);if(console.log(t.settings.repoName,t.settings.repoBranch),console.log(l,y,O,k,z),l&&d.value&&localStorage.setItem("access_token",ne(u)||""),l)if(!y||!k){C.error("仓库/分支不存在或无权限"),c.value=!0,(await W.getRepoNames()).forEach(F=>{x.value.push({label:F.name,value:F.name})}),N.value&&$(N.value);return}else if(O){if(!z){C.error("请先安装应用"),window.location.href=`https://github.com/apps/${Ee}/installations/new`;return}}else{C.error("无推送权限，请重新登录");return}else{C.error("Token无效，请重新登录");return}console.log("登录成功"),await t.syncRemoteSettings(),a.push({name:"launch"})};Q(async()=>{const u=localStorage.getItem("remember");d.value=u==="true";const l=localStorage.getItem("loginMethod");s.value=l||"github",S=n.query.access_token,S&&(r.value=!0,a.replace({query:{}}),r.value=!0,await A(S),r.value=!1)});const V=u=>{localStorage.setItem("remember",u.toString())},D=async()=>{if(localStorage.setItem("loginMethod",s.value),f.value)S=f.value,d.value&&localStorage.setItem("access_token",ne(S)||""),r.value=!0,await A(S),r.value=!1;else{C.error("请输入Token");return}},o=async()=>{localStorage.setItem("loginMethod",s.value);const u=new URLSearchParams(Object.entries(n.query).map(([O,k])=>[O,k]));u.has("time")?u.set("time",Date.now().toString()):u.append("time",Date.now().toString()),await a.push({query:{...n.query,time:u.get("time")}}),await Be();const l=window.location.href,y=`https://github.com/login/oauth/authorize?client_id=${$e}&state=${encodeURIComponent(l)}`;window.location.replace(y),r.value=!0},i=async()=>{console.log("repoName",t.settings.repoName),r.value=!0,await A(S),r.value=!1},g=()=>{localStorage.setItem("jumpLogin","true"),t.settings.repoName="inkstone.local",a.replace({name:"main"})};return(u,l)=>{const y=oe,O=Oe,k=be,z=we,Y=xe,F=Se,Z=ke,J=_e,de=he;return b(),j("div",at,[ye((b(),j("div",rt,[w("div",ot,[m(y,{style:{height:"300px"},src:"/img/login_cover.jpg",fit:"cover",class:"cover-image"})]),c.value?(b(),j("div",ft,[l[12]||(l[12]=w("div",null,[w("h2",null,"选择仓库")],-1)),w("div",null,[m(J,{modelValue:P(t).settings.repoName,"onUpdate:modelValue":l[4]||(l[4]=p=>P(t).settings.repoName=p),placeholder:"请选择将要使用的仓库",size:"large",style:{width:"240px"}},{default:h(()=>[(b(!0),j(ee,null,te(x.value,p=>(b(),R(Z,{key:p.value,label:p.label,value:p.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),m(J,{modelValue:P(t).settings.repoBranch,"onUpdate:modelValue":l[5]||(l[5]=p=>P(t).settings.repoBranch=p),placeholder:"请选择将要使用的分支",size:"large",style:{width:"240px"}},{default:h(()=>[(b(!0),j(ee,null,te(_.value,p=>(b(),R(Z,{key:p.value,label:p.label,value:p.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),w("div",null,[m(z,{type:"primary",size:"large",onClick:i},{default:h(()=>l[11]||(l[11]=[T(" 登录 ")])),_:1})])])):(b(),j("div",lt,[w("div",st,[l[7]||(l[7]=w("h2",null,"后台登录",-1)),m(k,{class:"box-item",effect:"dark",content:"跳过登录，只使用编辑器基础功能",placement:"right-start"},{default:h(()=>[m(O,{class:"jump",type:"primary",effect:"light",onClick:g},{default:h(()=>l[6]||(l[6]=[T("跳过")])),_:1})]),_:1})]),w("div",null,[s.value==="github"?(b(),R(z,{key:0,type:"primary",size:"large",onClick:o},{default:h(()=>[l[8]||(l[8]=T(" 授权登录 ")),m(P(M),{class:"el-icon--right",icon:["fab","github"],size:"2xl"})]),_:1})):(b(),R(Y,{key:1,modelValue:f.value,"onUpdate:modelValue":l[0]||(l[0]=p=>f.value=p),clearable:"","show-password":"",placeholder:"请输入Token"},{append:h(()=>[m(z,{type:"primary",onClick:D},{default:h(()=>l[9]||(l[9]=[T("登录")])),_:1})]),_:1},8,["modelValue"]))]),w("div",it,[w("span",ut,[m(k,{class:"box-item",effect:"dark",content:"Token将被保存到本地，请注意秘钥安全",placement:"top"},{default:h(()=>[m(F,{modelValue:d.value,"onUpdate:modelValue":l[1]||(l[1]=p=>d.value=p),onChange:V},{default:h(()=>l[10]||(l[10]=[T("保持登录")])),_:1},8,["modelValue"])]),_:1})]),w("span",ct,[m(k,{class:"box-item",effect:"dark",content:"Github 授权登录",placement:"top"},{default:h(()=>[m(P(M),{icon:["fab","github"],class:X(s.value==="github"?"select":""),onClick:l[2]||(l[2]=p=>s.value="github"),size:"xl",style:{"margin-right":"20px"}},null,8,["class"])]),_:1}),m(k,{class:"box-item",effect:"dark",content:"手动输入Token登录",placement:"top"},{default:h(()=>[m(P(M),{icon:["fas","key"],class:X(s.value==="token"?"select":""),onClick:l[3]||(l[3]=p=>s.value="token"),size:"xl"},null,8,["class"])]),_:1})])])]))])),[[de,r.value]])])}}}),dt=ue(pt,[["__scopeId","data-v-0bb36f9e"]]),U="/",mt=[{path:`${U}`,component:Ke,name:"launch"},{path:`${U}main`,component:Ne,name:"main"},{path:`${U}login`,component:dt,name:"login"}],vt=Le({history:ze(U),routes:mt,scrollBehavior(e,t,n){return e.hash?{el:e.hash,behavior:"smooth"}:n||{top:0}}});Fe();const E=Ie(Me),gt=Ae();E.use(gt);E.use(vt);E.use(Ve);E.component("FontAwesomeIcon",M);E.mount("#app");export{M as F};
